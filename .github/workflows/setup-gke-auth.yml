name: Setup GKE Auth Plugin

on:
  workflow_call:

jobs:
  setup-gke-auth:
    runs-on: ubuntu-latest
    steps:
    - name: Install gke-gcloud-auth-plugin
      run: |
        # Install gpg if not available
        sudo apt-get update
        sudo apt-get install -y gnupg
        
        # Add Google Cloud SDK repository
        sudo mkdir -p /usr/share/keyrings
        curl -fsSL https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo gpg --dearmor -o /usr/share/keyrings/cloud.google.gpg
        echo "deb [signed-by=/usr/share/keyrings/cloud.google.gpg] https://packages.cloud.google.com/apt cloud-sdk main" | sudo tee /etc/apt/sources.list.d/google-cloud-sdk.list
        
        # Update and install plugin
        sudo apt-get update
        sudo apt-get install -y google-cloud-sdk-gke-gcloud-auth-plugin
        
        echo "USE_GKE_GCLOUD_AUTH_PLUGIN=True" >> $GITHUB_ENV
